<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="KubeVela Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="KubeVela Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5GLR1Y52M7"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-5GLR1Y52M7",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="KubeVela" href="/zh/opensearch.xml"><title data-react-helmet="true">ä½¿ç”¨ Jenkins + KubeVela å®Œæˆåº”ç”¨çš„æŒç»­äº¤ä»˜ | KubeVela</title><meta data-react-helmet="true" property="og:title" content="ä½¿ç”¨ Jenkins + KubeVela å®Œæˆåº”ç”¨çš„æŒç»­äº¤ä»˜ | KubeVela"><meta data-react-helmet="true" property="og:url" content="https://kubevela.io/zh/blog/2021/09/02/kubevela-jenkins-cicd"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:image" content="https://raw.githubusercontent.com/oam-dev/kubevela.io/main/docs/resources/KubeVela-03.png"><meta data-react-helmet="true" name="twitter:image" content="https://raw.githubusercontent.com/oam-dev/kubevela.io/main/docs/resources/KubeVela-03.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kubevela.io/zh/blog/2021/09/02/kubevela-jenkins-cicd"><link data-react-helmet="true" rel="alternate" href="https://kubevela.io/blog/2021/09/02/kubevela-jenkins-cicd" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kubevela.io/zh/blog/2021/09/02/kubevela-jenkins-cicd" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://kubevela.io/blog/2021/09/02/kubevela-jenkins-cicd" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.1f84ae86.css">
<link rel="preload" href="/zh/assets/js/runtime~main.312f92b6.js" as="script">
<link rel="preload" href="/zh/assets/js/main.aa5d7873.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo.svg" alt="KubeVela" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/logoDark.svg" alt="KubeVela" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">KubeVela</strong></a><a class="navbar__item navbar__link" href="/zh/docs/">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/zh/docs/">v1.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">v1.3</a></li><li><a class="dropdown__link" href="/zh/docs/v1.2/">v1.2</a></li><li><a class="dropdown__link" href="/zh/docs/v1.1/">v1.1</a></li><li><a class="dropdown__link" href="/zh/docs/v1.0/">v1.0</a></li></ul></div><a href="https://kubevela.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">å›½å†…åŠ é€Ÿ</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/09/02/kubevela-jenkins-cicd" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/2021/09/02/kubevela-jenkins-cicd" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/oam-dev/kubevela" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo.svg" alt="KubeVela" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/logoDark.svg" alt="KubeVela" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">KubeVela</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/zh/docs/next/">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/">v1.3</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/v1.2/">v1.2</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/v1.1/">v1.1</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/v1.0/">v1.0</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/">æ–‡æ¡£</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/zh/blog">åšå®¢</a></li><li class="menu__list-item"><a href="https://kubevela.net" target="_blank" rel="noopener noreferrer" class="menu__link">å›½å†…åŠ é€Ÿ</a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/blog/2021/09/02/kubevela-jenkins-cicd" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/zh/blog/2021/09/02/kubevela-jenkins-cicd" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/oam-dev/kubevela" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2022/04/06/multi-cluster-management">KubeVela v1.3 å¤šé›†ç¾¤åˆä½“éªŒï¼Œè½»æ¾ç®¡ç†åº”ç”¨åˆ†å‘å’Œå·®å¼‚åŒ–é…ç½®</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2022/04/01/offline-deployment-practice copy">China Merchants Bank&#x27;s Practice on Offline Installation with KubeVela</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2022/03/02/kubevela-with-machine-learning">åŸºäº KubeVela çš„æœºå™¨å­¦ä¹ å®è·µ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2022/03/01/kubevela-generate-top-50-popular-resources-of-aws-using-100-lines-of-code">å¦‚ä½•ç”¨ 100 è¡Œä»£ç å¿«é€Ÿå¼•å…¥ AWS æœ€å—æ¬¢è¿çš„ 50 ç§äº‘èµ„æº</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2022/01/27/blog-1.2">KubeVela v1.2 å‘å¸ƒï¼šèšç„¦å¼€å‘è€…ä½“éªŒï¼Œè½»æ¾å‘å¸ƒä½ çš„å¤šé›†ç¾¤åº”ç”¨</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">ä½¿ç”¨ Jenkins + KubeVela å®Œæˆåº”ç”¨çš„æŒç»­äº¤ä»˜</h1><div class="margin-vert--md"><time datetime="2021-09-02T00:00:00.000Z" class="blogPostDate_fNvV">2021å¹´9æœˆ2æ—¥ Â· é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</time></div><div class="avatar margin-vert--md"><a href="https://github.com/oam-dev/kubevela" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://kubevela.io/img/logo.svg" alt="Da Yin, Yang Song"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/oam-dev/kubevela" target="_blank" rel="noopener noreferrer">Da Yin, Yang Song</a></h4><small class="avatar__subtitle">KubeVela å›¢é˜Ÿ</small></div></div></header><div class="markdown"><p>KubeVela æ‰“é€šäº†åº”ç”¨ä¸åŸºç¡€è®¾æ–½ä¹‹é—´çš„äº¤ä»˜ç®¡æ§çš„å£å’ï¼Œç›¸è¾ƒäºåŸç”Ÿçš„ Kubernetes å¯¹è±¡ï¼ŒKubeVela çš„ Application æ›´å¥½åœ°ç®€åŒ–æŠ½è±¡äº†å¼€å‘è€…éœ€è¦å…³å¿ƒçš„é…ç½®ï¼Œå°†å¤æ‚çš„åŸºç¡€è®¾æ–½èƒ½åŠ›åŠç¼–æ’ç»†èŠ‚ç•™ç»™äº†å¹³å°å·¥ç¨‹å¸ˆã€‚è€Œ KubeVela çš„ apiserver åˆ™æ˜¯è¿›ä¸€æ­¥ä¸ºå¼€å‘è€…æä¾›äº†ä½¿ç”¨ HTTP Request ç›´æ¥æ“çºµ Application çš„é€”å¾„ï¼Œä½¿å¾—å¼€å‘è€…å³ä½¿æ²¡æœ‰ Kubernetes çš„ä½¿ç”¨ç»éªŒä¸é›†ç¾¤è®¿é—®æƒé™ä¹Ÿå¯ä»¥è½»æ¾éƒ¨ç½²è‡ªå·±çš„åº”ç”¨ã€‚</p><p>æœ¬æ–‡å°±ä»¥ç»å…¸çš„æŒç»­é›†æˆ (Continuous Integration) å·¥å…· Jenkins ä¸ºåŸºç¡€ï¼Œç®€å•ä»‹ç»å¦‚ä½•æ‰“é€ åŸºäº GitOps çš„åº”ç”¨æŒç»­äº¤ä»˜çš„â€œé«˜é€Ÿå…¬è·¯â€ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æŒç»­äº¤ä»˜é«˜é€Ÿå…¬è·¯"></a>æŒç»­äº¤ä»˜â€œé«˜é€Ÿå…¬è·¯â€<a class="hash-link" href="#æŒç»­äº¤ä»˜é«˜é€Ÿå…¬è·¯" title="Direct link to heading">#</a></h2><p>ä½œä¸ºåº”ç”¨å¼€å‘è€…çš„ä½ ï¼Œæ›´å¤šåœ°å…³å¿ƒè‡ªå·±çš„åº”ç”¨æ˜¯å¦æ­£å¸¸è¿ä½œï¼Œå¼€å‘æµç¨‹æ˜¯å¦ä¾¿æ·é«˜æ•ˆã€‚ä¸ºæ­¤ï¼Œåœ¨è¿™æ¡æŒç»­äº¤ä»˜çš„â€œé«˜é€Ÿå…¬è·¯â€ä¸Šï¼Œå°†ä¼šç”±ä»¥ä¸‹éƒ¨ä»¶ä¸ºä½ ä¿é©¾æŠ¤èˆªã€‚</p><ol><li>ä½ éœ€è¦ä¸€ä¸ª git ä»“åº“æ¥å­˜æ”¾åº”ç”¨ç¨‹åºä»£ç ã€æµ‹è¯•ä»£ç ï¼Œä»¥åŠæè¿° KubeVela Application çš„ YAML æ–‡ä»¶ã€‚</li><li>ä½ éœ€è¦ä¸€ä¸ªæŒç»­é›†æˆ (Continuous Integration) çš„å·¥å…·å¸®ä½ è‡ªåŠ¨åŒ–å®Œæˆç¨‹åºä»£ç çš„æµ‹è¯•ï¼Œå¹¶æ‰“åŒ…æˆé•œåƒä¸Šä¼ åˆ°ä»“åº“ä¸­ã€‚</li><li>ä½ éœ€è¦åœ¨ Kubernetes é›†ç¾¤ä¸Šå®‰è£… KubeVela å¹¶å¯ç”¨ apiserver åŠŸèƒ½ã€‚</li></ol><blockquote><p>ç›®å‰ KubeVela çš„ apiserver åœ¨æƒé™è®¤è¯æ–¹é¢ä»å¾…å®Œå–„ï¼Œåç»­å¯ç”¨ apiserver åå°†ä¼šåŠ å…¥æƒé™é…ç½®ç¯èŠ‚ã€‚</p></blockquote><p>æœ¬æ–‡çš„ä»‹ç»ä¸­é‡‡ç”¨äº† Github ä½œä¸º git ä»“åº“ï¼ŒJenkins ä½œä¸º CI å·¥å…·ï¼ŒDockerHub ä½œä¸ºé•œåƒä»“åº“ã€‚åº”ç”¨ç¨‹åºä»¥ä¸€ä¸ªç®€å•çš„ HTTP Server ä¸ºä¾‹ï¼Œæ•´ä¸ªæŒç»­äº¤ä»˜çš„æµç¨‹å¦‚ä¸‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™æ¡æŒç»­äº¤ä»˜çš„â€œé«˜é€Ÿå…¬è·¯â€ä¸Šï¼Œå¼€å‘è€…åªéœ€è¦å…³å¿ƒåº”ç”¨çš„å¼€å‘å¹¶ä½¿ç”¨ Git è¿›è¡Œä»£ç ç‰ˆæœ¬çš„ç»´æŠ¤ï¼Œå³å¯è‡ªåŠ¨èµ°å®Œæµ‹è¯•æµç¨‹å¹¶éƒ¨ç½²åº”ç”¨åˆ° Kubernetes é›†ç¾¤ä¸­ã€‚</p><p><img alt="arch" src="/zh/assets/images/arch-53b2b1a473f0d637d4c7c0b9a81dd2b0.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="éƒ¨ç½²ç¯å¢ƒ"></a>éƒ¨ç½²ç¯å¢ƒ<a class="hash-link" href="#éƒ¨ç½²ç¯å¢ƒ" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="jenkins-ç¯å¢ƒ"></a>Jenkins ç¯å¢ƒ<a class="hash-link" href="#jenkins-ç¯å¢ƒ" title="Direct link to heading">#</a></h3><blockquote><p>æœ¬æ–‡é‡‡ç”¨äº† Jenkins ä½œä¸ºæŒç»­é›†æˆå·¥å…·ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– CI å·¥å…·ï¼Œå¦‚ TravisCI æˆ–è€… GitHub Actionã€‚</p></blockquote><p>é¦–å…ˆä½ éœ€è¦å‡†å¤‡ä¸€ä»½ Jenkins ç¯å¢ƒæ¥éƒ¨ç½² CI æµæ°´çº¿ã€‚å®‰è£…ä¸åˆå§‹åŒ– Jenkins æµç¨‹å¯ä»¥å‚è§<a href="https://www.jenkins.io/doc/book/installing/linux/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæœ¬æ–‡çš„ CI æµæ°´çº¿æ˜¯åŸºäº Docker åŠ GitHub çš„ï¼Œå› æ­¤åœ¨å®‰è£… Jenkins ä¹‹åè¿˜éœ€è¦å®‰è£…ç›¸å…³æ’ä»¶ (Dashboard &gt; Manage Jenkins &gt; Manage Plugins) ï¼ŒåŒ…æ‹¬ Pipelineã€HTTP Request Pluginã€Docker Pipelineã€Docker Pluginã€‚</p><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦ä¸º Jenkins é…ç½® Docker çš„è¿è¡Œç¯å¢ƒ (Dashboard &gt; Manage Jenkins &gt; Configure System &gt; Docker Builder) ï¼Œå¦‚ Jenkins æ‰€åœ¨ç¯å¢ƒå·²ç»å®‰è£…äº† Dockerï¼Œå¯ä»¥å°† Docker URL é…ç½®ä¸º <code>unix:///var/run/docker.sock</code>ã€‚</p><p>ç”±äºåœ¨ CI æµæ°´çº¿è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦å°†å®¹å™¨é•œåƒæ¨è‡³é•œåƒä»“åº“ï¼Œä¸ºæ­¤éœ€åœ¨ Jenkins çš„ Credential ä¸­å°†é•œåƒä»“åº“çš„è´¦æˆ·é…ç½®å¥½ (Dashboard &gt; Manage Jenkins &gt; Manage Credentials &gt; Add Credentials) ï¼Œæ¯”å¦‚å°† DockerHub çš„ç”¨æˆ·ååŠå¯†ç å­˜å…¥ã€‚</p><p><img alt="jenkins-credential" src="/zh/assets/images/jenkins-credential-52c71b3f3a886ec0596a29a2356ad291.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="github-ä»“åº“ç¯å¢ƒ"></a>GitHub ä»“åº“ç¯å¢ƒ<a class="hash-link" href="#github-ä»“åº“ç¯å¢ƒ" title="Direct link to heading">#</a></h3><blockquote><p>æœ¬æ–‡çš„ä»‹ç»é‡‡ç”¨äº† Github ä½œä¸ºä»£ç ä»“åº“ï¼Œå¼€å‘è€…è¿˜å¯ä»¥æ ¹æ®å„è‡ªçš„éœ€æ±‚ä¸å–œå¥½ï¼Œä½¿ç”¨å…¶ä»–ä»£ç ä»“åº“ï¼Œå¦‚ Gitlabã€‚</p></blockquote><p>ä¸ºä½¿æŒç»­é›†æˆå·¥å…· Jenkins èƒ½å¤Ÿè·å–åˆ° GitHub ä¸­çš„æ›´æ–°ï¼Œå¹¶å°†æµæ°´çº¿çš„è¿è¡ŒçŠ¶æ€åé¦ˆå› GitHubï¼Œéœ€è¦åœ¨ GitHub ä¸­å®Œæˆä»¥ä¸‹ä¸¤æ­¥æ“ä½œã€‚</p><ol><li><a href="https://github.com/settings/tokens/new" target="_blank" rel="noopener noreferrer">é…ç½®</a> Personal Access Tokenã€‚æ³¨æ„å°† <code>repo:status</code> å‹¾é€‰ï¼Œä»¥è·å¾—å‘ GitHub æ¨é€ Commit çŠ¶æ€çš„æƒé™ã€‚</li></ol><p><img alt="github-pat" src="/zh/assets/images/github-pat-a8de5950eaf01a6d416a869d70b189ac.png"></p><p>ç„¶ååœ¨ Jenkins çš„ Credential ä¸­åŠ å…¥ Secret Text ç±»å‹çš„ Credential å¹¶å°†ä¸Šè¿°çš„ GitHub çš„ Personal Access Token å¡«å…¥ã€‚</p><p><img alt="jenkins-secret-text" src="/zh/assets/images/jenkins-secret-text-0de6c324500b26a5bfb81520ff7eab2b.png"></p><p>æœ€åæ¥åˆ° Jenkins çš„ Dashboard &gt; Manage Jenkins &gt; Configure System &gt; GitHub ä¸­ç‚¹å‡» Add GitHub Server å¹¶å°†åˆšæ‰åˆ›å»ºçš„ Credential å¡«å…¥ã€‚å®Œæˆåå¯ä»¥ç‚¹å‡» Test connection æ¥éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ã€‚</p><p><img alt="jenkins-github" src="/zh/assets/images/jenkins-github-e99c47fab606f6c9c9f3f6f841840329.png"></p><ol start="2"><li>åœ¨ GitHub çš„ä»£ç ä»“åº“çš„è®¾å®šé‡Œæ·»åŠ  Webhookï¼Œå°† Jenkins çš„åœ°å€å¯¹åº”çš„ Webhook åœ°å€å¡«å…¥ï¼Œæ¯”å¦‚ <a href="http://my-jenkins.example.com/github-webhook/" target="_blank" rel="noopener noreferrer">http://my-jenkins.example.com/github-webhook/</a> ã€‚è¿™æ ·ï¼Œè¯¥ä»£ç ä»“åº“çš„æ‰€æœ‰ Push äº‹ä»¶æ¨é€åˆ° Jenkins ä¸­ã€‚</li></ol><p><img alt="github-webhook" src="/zh/assets/images/github-webhook-5579402b6bc37238d42842fd5d52fd02.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="kubevela-ç¯å¢ƒ"></a>KubeVela ç¯å¢ƒ<a class="hash-link" href="#kubevela-ç¯å¢ƒ" title="Direct link to heading">#</a></h3><p>ä½ éœ€è¦åœ¨ Kubernetes é›†ç¾¤ä¸­å®‰è£… KubeVelaï¼Œå¹¶å¯ç”¨ apiserver åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒ<a href="/zh/docs/platform-engineers/advanced-install#install-kubevela-with-apiserver">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç¼–å†™åº”ç”¨"></a>ç¼–å†™åº”ç”¨<a class="hash-link" href="#ç¼–å†™åº”ç”¨" title="Direct link to heading">#</a></h2><p>æœ¬æ–‡é‡‡ç”¨çš„åº”ç”¨æ˜¯ä¸€ä¸ªåŸºäº Golang è¯­è¨€ç¼–å†™çš„ç®€å•çš„ HTTP Serverã€‚åœ¨ä»£ç ä¸­ï¼Œå£°æ˜äº†ä¸€ä¸ªåå« <code>VERSION</code> çš„å¸¸é‡ï¼Œå¹¶åœ¨è®¿é—®è¯¥æœåŠ¡æ—¶æ‰“å°å‡ºæ¥ã€‚åŒæ—¶è¿˜é™„å¸¦ä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œç”¨æ¥æ ¡éªŒ <code>VERSION</code> çš„æ ¼å¼æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><div tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// main.go</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;fmt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> VERSION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.1.0-v1alpha1&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">main</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">HandleFunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">w http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResponseWriter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> r </span><span class="token operator">*</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token boolean">_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Fprintf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Version: %s\n&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> VERSION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ListenAndServe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;:8088&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">println</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><div tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// main_test.go</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;regexp&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;testing&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> verRegex </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">`^v?([0-9]+)(\.[0-9]+)?(\.[0-9]+)?`</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">`(-([0-9A-Za-z\-]+(\.[0-9A-Za-z\-]+)*))?`</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">`(\+([0-9A-Za-z\-]+(\.[0-9A-Za-z\-]+)*))?$`</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">TestVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t </span><span class="token operator">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">T</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator">:=</span><span class="token plain"> regexp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">MatchString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">verRegex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> VERSION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">ok </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Fatalf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;invalid version: %s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> VERSION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>åœ¨åº”ç”¨äº¤ä»˜æ—¶éœ€è¦å°† Golang æœåŠ¡æ‰“åŒ…æˆé•œåƒå¹¶ä»¥ KubeVela Application çš„å½¢å¼å‘å¸ƒåˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œå› æ­¤åœ¨ä»£ç ä»“åº“ä¸­è¿˜åŒ…å« <code>Dockerfile</code> ä»¥åŠ <code>app.yaml</code> æ–‡ä»¶ï¼Œåˆ†åˆ«ç”¨æ¥æè¿°é•œåƒçš„æ‰“åŒ…æ–¹å¼ä»¥åŠ Application çš„ç›¸å…³é…ç½®ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Dockerfile"><div tabindex="0" class="prism-code language-Dockerfile codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Dockerfile</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">FROM golang:1.13-rc-alpine3.10 as builder</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">WORKDIR /app</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">COPY main.go .</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">RUN go build -o kubevela-demo-cicd-app main.go</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">FROM alpine:3.10</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">WORKDIR /app</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">COPY --from=builder /app/kubevela-demo-cicd-app /app/kubevela-demo-cicd-app</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">ENTRYPOINT ./kubevela-demo-cicd-app</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">EXPOSE 8088</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>åœ¨ app.yaml ä¸­ï¼Œå£°æ˜äº†éƒ¨ç½²çš„åº”ç”¨åŒ…å« 5 ä¸ªä¸åŒå‰¯æœ¬ï¼ŒåŒæ—¶é€šè¿‡ Ingress çš„å½¢å¼å‘å¸ƒç»™é›†ç¾¤å¤–éƒ¨ã€‚è€Œ labels åˆ™æ˜¯ç»™åº”ç”¨ä¸­çš„ Pod æ‰“ä¸Šäº†å½“å‰çš„ git commit ä½œä¸ºæ ‡ç­¾ã€‚å½“ Jenkins çš„éƒ¨ç½²æµæ°´çº¿è¿è¡Œæ—¶ï¼Œä¼šå°† GIT_COMMIT æ³¨å…¥å…¶ä¸­ï¼Œæäº¤åˆ° KubeVela apiserverï¼Œä»è€Œè§¦å‘ Application çš„æ›´æ–°ã€‚åœ¨ç‰ˆæœ¬æ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§ 2, 3 çš„æ•°é‡åˆ†ä¸¤æ¬¡æ¬¡æ›´æ–°å‰¯æœ¬ï¼ŒåŒæ—¶åœ¨ç¬¬ä¸€æ¬¡æ›´æ–°ååœæ­¢è‡ªåŠ¨æ›´æ–°ï¼Œç­‰å¾…æ‰‹åŠ¨ç¡®è®¤åå†è¿›è¡Œå…¨éƒ¨æ›´æ–°ï¼Œå®ç°é‡‘ä¸é›€å‘å¸ƒçš„è¿‡ç¨‹ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># app.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> core.oam.dev/v1beta1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Application</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kubevela</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">app</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">components</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kubevela</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">web</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> webservice</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> somefive/kubevela</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">cicd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">app</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Always</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">8080</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">traits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> rollout</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">rolloutBatches</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">batchPartition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">targetSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> labels</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">jenkins-build-commit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> GIT_COMMIT</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ingress</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">domain</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kubevela</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">cicd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">app.cf7c0ed25b151437ebe1ef58efc29bca4.us</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">west</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">1.alicontainer.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token key atrule">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">8088</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é…ç½®-ci-æµæ°´çº¿"></a>é…ç½® CI æµæ°´çº¿<a class="hash-link" href="#é…ç½®-ci-æµæ°´çº¿" title="Direct link to heading">#</a></h2><p>åœ¨æœ¬æ–‡çš„æ¡ˆä¾‹ä¸­ï¼ŒåŒ…å«ä¸¤æ¡æµæ°´çº¿ï¼Œä¸€æ¡æ˜¯ç”¨æ¥è¿›è¡Œæµ‹è¯•çš„æµæ°´çº¿ (å¯¹åº”ç”¨ä»£ç è¿è¡Œæµ‹è¯•) ï¼Œä¸€æ¡æ˜¯äº¤ä»˜æµæ°´çº¿ (å°†åº”ç”¨ä»£ç æ‰“åŒ…ä¸Šä¼ é•œåƒä»“åº“ï¼ŒåŒæ—¶æ›´æ–°ç›®æ ‡ç¯å¢ƒä¸­çš„åº”ç”¨ï¼Œå®ç°è‡ªåŠ¨æ›´æ–°) ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æµ‹è¯•æµæ°´çº¿"></a>æµ‹è¯•æµæ°´çº¿<a class="hash-link" href="#æµ‹è¯•æµæ°´çº¿" title="Direct link to heading">#</a></h3><p>åœ¨ Jenkins ä¸­åˆ›å»ºä¸€æ¡æ–°çš„ Pipelineï¼Œå¹¶é…ç½® Build Triggers ä¸º GitHub hook trigger for GITScm pollingã€‚</p><p><img alt="test-pipeline-create" src="/zh/assets/images/test-pipeline-create-34edf7a7b95307cec884803ca545c2e3.png">
<img alt="test-pipeline-config" src="/zh/assets/images/test-pipeline-config-3ae2830ca7d45dbe9579a7814d96abc0.png"></p><p>åœ¨è¿™æ¡æµæ°´çº¿ä¸­ï¼Œé¦–å…ˆæ˜¯é‡‡ç”¨äº† golang çš„é•œåƒä½œä¸ºæ‰§è¡Œç¯å¢ƒï¼Œæ–¹ä¾¿åç»­è¿è¡Œæµ‹è¯•ã€‚ç„¶åå°†åˆ†æ”¯é…ç½®ä¸º GitHub ä»“åº“ä¸­çš„ dev åˆ†æ”¯ï¼Œä»£è¡¨è¯¥æ¡æµæ°´çº¿è¢« Push äº‹ä»¶è§¦å‘åä¼šæ‹‰å– dev åˆ†æ”¯ä¸Šçš„å†…å®¹å¹¶æ‰§è¡Œæµ‹è¯•ã€‚æµ‹è¯•ç»“æŸåå°†æµæ°´çº¿çš„çŠ¶æ€å›å†™è‡³ GitHub ä¸­ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><div tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">void setBuildStatus(String message, String state) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  step([</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      $class: &quot;GitHubCommitStatusSetter&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      reposSource: [$class: &quot;ManuallyEnteredRepositorySource&quot;, url: &quot;https://github.com/Somefive/KubeVela-demo-CICD-app&quot;],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      contextSource: [$class: &quot;ManuallyEnteredCommitContextSource&quot;, context: &quot;ci/jenkins/test-status&quot;],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      errorHandlers: [[$class: &quot;ChangingBuildStatusErrorHandler&quot;, result: &quot;UNSTABLE&quot;]],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      statusResultSource: [ $class: &quot;ConditionalStatusResultSource&quot;, results: [[$class: &quot;AnyBuildResult&quot;, message: message, state: state]] ]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  ]);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    agent {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        docker { image &#x27;golang:1.13-rc-alpine3.10&#x27; }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    stages {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        stage(&#x27;Prepare&#x27;) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            steps {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                script {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    def checkout = git branch: &#x27;dev&#x27;, url: &#x27;https://github.com/Somefive/KubeVela-demo-CICD-app.git&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    env.GIT_COMMIT = checkout.GIT_COMMIT</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    env.GIT_BRANCH = checkout.GIT_BRANCH</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    echo &quot;env.GIT_BRANCH=${env.GIT_BRANCH},env.GIT_COMMIT=${env.GIT_COMMIT}&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                setBuildStatus(&quot;Test running&quot;, &quot;PENDING&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        stage(&#x27;Test&#x27;) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            steps {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                sh &#x27;CGO_ENABLED=0 GOCACHE=$(pwd)/.cache go test *.go&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    post {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        success {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            setBuildStatus(&quot;Test success&quot;, &quot;SUCCESS&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        failure {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            setBuildStatus(&quot;Test failed&quot;, &quot;FAILURE&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="éƒ¨ç½²æµæ°´çº¿"></a>éƒ¨ç½²æµæ°´çº¿<a class="hash-link" href="#éƒ¨ç½²æµæ°´çº¿" title="Direct link to heading">#</a></h3><p>åœ¨éƒ¨ç½²æµæ°´çº¿ä¸­ï¼Œç±»ä¼¼æµ‹è¯•æµæ°´çº¿ï¼Œé¦–å…ˆå°†ä»£ç ä»“åº“ä¸­çš„åˆ†æ”¯æ‹‰å–ä¸‹æ¥ï¼ŒåŒºåˆ«æ˜¯è¿™é‡Œé‡‡ç”¨ prod åˆ†æ”¯ã€‚ç„¶åä½¿ç”¨ Docker è¿›è¡Œé•œåƒæ„å»ºå¹¶æ¨é€è‡³è¿œç«¯é•œåƒä»“åº“ (è¿™é‡Œä¸º DockerHubï¼Œå…¶ä¸­ withRegistry ä¸­å¡«å†™é•œåƒä»“åº“ä½ç½®ä»¥åŠåœ¨å…ˆå‰æ­¥éª¤ä¸­å­˜å…¥çš„ DockerHub çš„è´¦æˆ·å¯¹åº”çš„ Credential çš„ ID) ã€‚æ„å»ºæˆåŠŸåï¼Œå†å°† Application å¯¹åº”çš„ YAML æ–‡ä»¶è½¬æ¢ä¸º JSON æ–‡ä»¶å¹¶æ³¨å…¥ GIT_COMMITï¼Œæœ€åå‘ KubeVela apiserver (æ­¤å¤„ä¸º <a href="http://47.88.24.19/" target="_blank" rel="noopener noreferrer">http://47.88.24.19/</a>) å‘é€è¯·æ±‚è¿›è¡Œåˆ›å»ºæˆ–æ›´æ–°ã€‚</p><blockquote><p>ç›®å‰çš„ KubeVela apiserver æ¥æ”¶ JSON å‚æ•°ï¼Œå› æ­¤åœ¨æµæ°´çº¿ä¸­åšäº†ç›¸åº”çš„è½¬æ¢ã€‚æœªæ¥çš„ KubeVela apiserver å°†ä¼šè¿›ä¸€æ­¥æ”¹è¿›äº¤äº’æ¨¡å¼ï¼Œç®€åŒ–æ­¤å¤„çš„æµç¨‹ï¼ŒåŒæ—¶å†åŠ ä¸Šæ›´ä¸ºä¸¥æ ¼çš„æƒé™è®¤è¯ï¼Œæé«˜å®‰å…¨æ€§ã€‚</p></blockquote><blockquote><p>è¯¥æ¡ˆä¾‹ä¸­ä¼šå‘ kubevela-demo-namespace è¿™ä¸ª Namespace ä¸­åˆ›å»ºåå« cicd-demo-app çš„åº”ç”¨ï¼Œæ³¨æ„è¿™ä¸ª Namespace éœ€è¦é¢„å…ˆåœ¨ Kubernetes ä¸­åˆ›å»ºå‡ºæ¥ã€‚æœªæ¥ KubeVela çš„ apiserver åŒæ ·ä¼šç®€åŒ–è¿™ä¸€æµç¨‹ã€‚</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><div tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">void setBuildStatus(String message, String state) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  step([</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      $class: &quot;GitHubCommitStatusSetter&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      reposSource: [$class: &quot;ManuallyEnteredRepositorySource&quot;, url: &quot;https://github.com/Somefive/KubeVela-demo-CICD-app&quot;],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      contextSource: [$class: &quot;ManuallyEnteredCommitContextSource&quot;, context: &quot;ci/jenkins/deploy-status&quot;],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      errorHandlers: [[$class: &quot;ChangingBuildStatusErrorHandler&quot;, result: &quot;UNSTABLE&quot;]],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      statusResultSource: [ $class: &quot;ConditionalStatusResultSource&quot;, results: [[$class: &quot;AnyBuildResult&quot;, message: message, state: state]] ]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  ]);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    agent any</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    stages {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        stage(&#x27;Prepare&#x27;) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            steps {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                script {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    def checkout = git branch: &#x27;prod&#x27;, url: &#x27;https://github.com/Somefive/KubeVela-demo-CICD-app.git&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    env.GIT_COMMIT = checkout.GIT_COMMIT</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    env.GIT_BRANCH = checkout.GIT_BRANCH</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    echo &quot;env.GIT_BRANCH=${env.GIT_BRANCH},env.GIT_COMMIT=${env.GIT_COMMIT}&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    setBuildStatus(&quot;Deploy running&quot;, &quot;PENDING&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        stage(&#x27;Build&#x27;) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            steps {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                script {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    docker.withRegistry(&quot;https://registry.hub.docker.com&quot;, &quot;DockerHubCredential&quot;) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                        def customImage = docker.build(&quot;somefive/kubevela-demo-cicd-app&quot;)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                        customImage.push()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        stage(&#x27;Deploy&#x27;) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            steps {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                sh &#x27;wget -q &quot;https://github.com/mikefarah/yq/releases/download/v4.12.1/yq_linux_amd64&quot;&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                sh &#x27;chmod +x yq_linux_amd64&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                script {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    def app = sh (</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                        script: &quot;./yq_linux_amd64 eval -o=json &#x27;.spec&#x27; app.yaml | sed -e &#x27;s/GIT_COMMIT/$GIT_COMMIT/g&#x27;&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                        returnStdout: true</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    )</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    echo &quot;app: ${app}&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    def response = httpRequest acceptType: &#x27;APPLICATION_JSON&#x27;, contentType: &#x27;APPLICATION_JSON&#x27;, httpMode: &#x27;POST&#x27;, requestBody: app, url: &quot;http://47.88.24.19/v1/namespaces/kubevela-demo-namespace/applications/cicd-demo-app&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    println(&#x27;Status: &#x27;+response.status)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    println(&#x27;Response: &#x27;+response.content)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    post {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        success {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            setBuildStatus(&quot;Deploy success&quot;, &quot;SUCCESS&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        failure {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            setBuildStatus(&quot;Deploy failed&quot;, &quot;FAILURE&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p>å¤‡æ³¨ï¼šä¸Šè¿°çš„ Deploy é˜¶æ®µæ˜¯åŸºäº KubeVela 1.1 ç‰ˆæœ¬çš„ã€‚åœ¨ KubeVela 1.2 ç‰ˆæœ¬ä¸­ï¼ŒJenkins å¯¹æ¥ KubeVela APIServer çš„æ–¹æ³•å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦ä½¿ç”¨ VelaUXï¼ˆUI æ§åˆ¶é¢æ¿ï¼‰å’Œ WebHook è§¦å‘å™¨ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ KubeVela v1.2.0+ï¼Œä½ éœ€è¦å‚è€ƒå¯¹åº”ç‰ˆæœ¬çš„ç›¸å…³æ–‡æ¡£ã€‚</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å®é™…è¡¨ç°"></a>å®é™…è¡¨ç°<a class="hash-link" href="#å®é™…è¡¨ç°" title="Direct link to heading">#</a></h2><p>åœ¨å®Œæˆä¸Šè¿°çš„é…ç½®æµç¨‹åï¼ŒæŒç»­äº¤ä»˜çš„æµç¨‹ä¾¿å·²ç»æ­å»ºå®Œæˆã€‚æˆ‘ä»¬å¯ä»¥æ¥æ£€éªŒä¸€ä¸‹å®ƒçš„æ•ˆæœã€‚</p><p><img alt="pipeline-overview" src="/zh/assets/images/pipeline-overview-36827d3925d667b9d14612cb59e8fb4e.png"></p><p>æˆ‘ä»¬é¦–å…ˆå°† <code>main.go</code> ä¸­çš„ <code>VERSION</code> å­—æ®µä¿®æ”¹ä¸º <code>Bad Version Number</code>ï¼Œå³</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><div tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> VERSION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Bad Version Number&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ç„¶åæäº¤è¯¥ä¿®æ”¹è‡³ dev åˆ†æ”¯ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Jenkins ä¸Šçš„æµ‹è¯•æµæ°´çº¿è¢«è§¦å‘è¿è¡Œï¼Œå¤±è´¥åå°†è¯¥çŠ¶æ€å›å†™ç»™ GitHubã€‚</p><p><img alt="test-pipeline-fail" src="/zh/assets/images/test-pipeline-fail-23682b9d0c60a43f26be0a5a98e8a413.png">
<img alt="test-github-fail" src="/zh/assets/images/test-github-fail-5dd21696c58a212cf6ca2ee80e56567e.png"></p><p>æˆ‘ä»¬é‡æ–°å°† <code>VERSION</code> ä¿®æ”¹ä¸º 0.1.1ï¼Œç„¶åå†æ¬¡æäº¤ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸€æ¬¡æµ‹è¯•æµæ°´çº¿æˆåŠŸå®Œæˆæ‰§è¡Œï¼Œå¹¶åœ¨ GitHub å¯¹åº”çš„ Commit ä¸Šçœ‹åˆ°äº†æˆåŠŸçš„æ ‡å¿—ã€‚</p><p><img alt="test-pipeline-success" src="/zh/assets/images/test-pipeline-success-cd84def7976efb35b5071c9e361d2a77.png">
<img alt="test-github-success" src="/zh/assets/images/test-github-success-1d9c59d67bfd9b24d8b455fa21c6d985.png"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ GitHub ä¸Šæäº¤ Pull Request å°è¯•å°† dev åˆ†æ”¯ä¸Šçš„æ›´æ–°åˆå¹¶è‡³ prod åˆ†æ”¯ä¸Šã€‚</p><p><img alt="pull-request" src="/zh/assets/images/pull-request-eca7ff259bb26a6661d79691728b0b31.png"></p><p>å¯ä»¥çœ‹åˆ°åœ¨ Jenkins çš„éƒ¨ç½²æµæ°´çº¿æˆåŠŸè¿è¡Œç»“æŸåï¼ŒGitHub ä¸Š prod åˆ†æ”¯æœ€æ–°çš„ Commit ä¹Ÿæ˜¾ç¤ºäº†æˆåŠŸçš„æ ‡å¿—ã€‚</p><p><img alt="deploy-pipeline-success" src="/zh/assets/images/deploy-pipeline-success-7890c92b41e666ef46f3bd2dc1975ee7.png">
<img alt="deploy-github-success" src="/zh/assets/images/deploy-github-success-07f305b1b587e3fa8acc5df68fd8c297.png"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get app -n kubevela-demo-namespace</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                     COMPONENT               TYPE         PHASE     HEALTHY   STATUS   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-cicd-app   kubevela-demo-app-web   webservice   running   </span><span class="token boolean">true</span><span class="token plain">               112s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get deployment -n kubevela-demo-namespace</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">2</span><span class="token plain">/2     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           2m1s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>å¦‚å›¾æ˜¾ç¤ºï¼Œè¦éƒ¨ç½²çš„åº”ç”¨é¡ºåˆ©è¢« KubeVela apiserver æ¥å—å¹¶ç”± KubeVela æ§åˆ¶å™¨åˆ›å»ºäº†ç›¸å…³èµ„æºã€‚å½“å‰ Deployment çš„å‰¯æœ¬æ•°æ˜¯ 2ï¼Œåœ¨åˆ é™¤äº†è¯¥ Application ä¸­ rollout ç‰¹å¾å†…çš„ <code>batchPartition: 0</code> åä»£è¡¨ç¡®è®¤äº†å½“å‰çš„å‘å¸ƒï¼Œç„¶åå¯¹åº”çš„ Deployment å‰¯æœ¬æ•°æ›´æ–°è‡³ 5ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è®¿é—® Ingress æ‰€é…ç½®çš„åŸŸåï¼ŒæˆåŠŸæ˜¾ç¤ºäº†å½“å‰çš„ç‰ˆæœ¬å·ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl edit app -n kubevela-demo-namespace</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">application.core.oam.dev/kubevela-demo-cicd-app edited</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get deployment -n kubevela-demo-namespace -w</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">4</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">4</span><span class="token plain">           3m39s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           3m39s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           3m40s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           3m40s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>æˆ‘ä»¬é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œå°†ç‰ˆæœ¬å‡çº§è‡³ 0.1.2ï¼Œå®Œæˆæµ‹è¯•æµæ°´çº¿åŠéƒ¨ç½²æµæ°´çº¿ã€‚æ¥ç€æˆ‘ä»¬ä¼šå‘ç° Kubernetes çš„é›†ç¾¤å†…å¯¹åº”çš„ Application æ§åˆ¶çš„ Deployment å‘ç”Ÿäº†ç‰ˆæœ¬æ›´æ›¿ï¼Œæ—§ç‰ˆæœ¬çš„ Deployment ä» 5 å‰¯æœ¬ä¸‹é™åˆ° 3 å‰¯æœ¬ï¼Œæ–°ç‰ˆæœ¬çš„ Deployment åˆ™å‡ºç°äº† 2 å‰¯æœ¬ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬å†è®¿é—®åŸæ¥çš„æœåŠ¡åœ°å€ï¼Œä¼šå‘ç°æœ‰æ—¶ä¼šæ˜¾ç¤º 0.1.1 ç‰ˆæœ¬ï¼Œæœ‰æ—¶ä¼šæ˜¾ç¤º 0.1.2 ç‰ˆæœ¬ã€‚è¿™æ˜¯å› ä¸ºåœ¨å½“å‰æ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ–°æ—§å‰¯æœ¬åŒæ—¶å­˜åœ¨ï¼Œè®¿é—®çš„æµé‡ä¼šè¢«è´Ÿè½½å‡è¡¡å™¨åˆ†å‘åˆ°ä¸åŒçš„å‰¯æœ¬ä¸Šï¼Œå› æ­¤ä¼šå‡ºç°ä¸¤ç§ç‰ˆæœ¬çš„æœåŠ¡åŒæ—¶å­˜åœ¨çš„ç°è±¡ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get deployment -n kubevela-demo-namespace -w</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           11m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           12m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/2     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/2     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/2     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">0</span><span class="token plain">/2     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           0s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           12m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">1</span><span class="token plain">/2     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">1</span><span class="token plain">           2s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">2</span><span class="token plain">/2     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           2s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/3     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           13m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">5</span><span class="token plain">/3     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           13m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">3</span><span class="token plain">/3     </span><span class="token number">3</span><span class="token plain">            </span><span class="token number">3</span><span class="token plain">           13m</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://kubevela-demo-cicd-app.cf7c0ed25b151437ebe1ef58efc29bca4.us-west-1.alicontainer.com/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Version: </span><span class="token number">0.1</span><span class="token plain">.1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>å½“æˆ‘ä»¬ç¡®è®¤æ–°ç‰ˆæœ¬çš„æœåŠ¡æ­£å¸¸è¿ä½œåï¼Œå¯ä»¥ç±»ä¼¼ä¸Šè¿°æ­¥éª¤ï¼Œå°† Application ä¸­ rollout ç‰¹æ€§å†…çš„ <code>batchPartition: 0</code> åˆ å»ï¼Œå®Œæˆæ•´ä¸ªé‡‘ä¸é›€å‘å¸ƒæµç¨‹ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get deployment -n kubevela-demo-namespace -w</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">3</span><span class="token plain">/3     </span><span class="token number">3</span><span class="token plain">            </span><span class="token number">3</span><span class="token plain">           18m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">2</span><span class="token plain">/2     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           5m24s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">2</span><span class="token plain">/5     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           5m36s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">2</span><span class="token plain">/5     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           5m37s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">2</span><span class="token plain">/5     </span><span class="token number">2</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           5m37s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">2</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">2</span><span class="token plain">           5m37s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">3</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">3</span><span class="token plain">           5m38s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">4</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">4</span><span class="token plain">           5m38s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           5m39s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">3</span><span class="token plain">/0     </span><span class="token number">3</span><span class="token plain">            </span><span class="token number">3</span><span class="token plain">           18m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">3</span><span class="token plain">/0     </span><span class="token number">3</span><span class="token plain">            </span><span class="token number">3</span><span class="token plain">           18m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           18m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           18m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           5m41s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v2   </span><span class="token number">5</span><span class="token plain">/5     </span><span class="token number">5</span><span class="token plain">            </span><span class="token number">5</span><span class="token plain">           5m41s</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubevela-demo-app-web-v1   </span><span class="token number">0</span><span class="token plain">/0     </span><span class="token number">0</span><span class="token plain">            </span><span class="token number">0</span><span class="token plain">           18m</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å°ç»“"></a>å°ç»“<a class="hash-link" href="#å°ç»“" title="Direct link to heading">#</a></h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä¾¿å·²ç»æˆåŠŸå®ç°äº†ä¸€æ•´å¥—æŒç»­äº¤ä»˜æµç¨‹ã€‚åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œåº”ç”¨çš„å¼€å‘è€…å€ŸåŠ© KubeVela + Jenkins çš„èƒ½åŠ›ï¼Œå¯ä»¥è½»æ¾å®Œæˆåº”ç”¨çš„è¿­ä»£æ›´æ–°ã€é›†æˆæµ‹è¯•ã€è‡ªåŠ¨å‘å¸ƒä¸æ»šåŠ¨å‡çº§ï¼Œè€Œæ•´ä¸ªæµç¨‹åœ¨å„ä¸ªç¯èŠ‚ä¹Ÿå¯ä»¥æŒ‰ç…§å¼€å‘è€…çš„å–œå¥½å’Œæ¡ä»¶é€‰æ‹©ä¸åŒçš„å·¥å…·ï¼Œæ¯”å¦‚ä½¿ç”¨ Gitlab æ›¿ä»£ GitHubï¼Œæˆ–æ˜¯ä½¿ç”¨ TravisCI æ›¿ä»£ Jenkinsã€‚</p><p>åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œç»†å¿ƒçš„è¯»è€…å¯èƒ½è¿˜ä¼šå‘ç°ï¼Œè¿™å¥—æµç¨‹ä¸ä»…èƒ½å¤Ÿå®ç°åº”ç”¨æœåŠ¡çš„å‡çº§ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡ä¿®æ”¹ app.yaml è‡ªåŠ¨å®Œæˆéƒ¨ç½²æ–¹æ¡ˆçš„å‡çº§ï¼Œæ¯”å¦‚å°† 5 å‰¯æœ¬åº”ç”¨æ‰©å®¹åˆ° 10 å‰¯æœ¬ï¼Œæˆ–æ˜¯ä¸ºå®¹å™¨æ·»åŠ  sidecarï¼Œä»è€Œå®ç°éƒ¨åˆ† GitOps èƒ½åŠ›ã€‚å…³äºä½¿ç”¨ KubeVela å®è·µ GitOps çš„æ›´å¤šå†…å®¹ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç»§ç»­é˜…è¯»ç›¸å…³æ¡ˆä¾‹ã€‚</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/zh/blog/tags/kube-vela">KubeVela</a></div></footer></article><div><a href="https://github.com/oam-dev/kubevela.io/tree/main/blog/2021-09-02-kubevela-jenkins-cicd.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æœ¬é¡µ</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/blog/2021/10/08/blog-1.1"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« KubeVela 1.1 å‘å¸ƒï¼Œå¼€å¯æ··åˆç¯å¢ƒåº”ç”¨æŒç»­äº¤ä»˜æ–°é‡Œç¨‹ç¢‘</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/blog/2021/08/30/kubevela-performance-test"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">KubeVela Performance Test - Managing Massive Applications Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æŒç»­äº¤ä»˜é«˜é€Ÿå…¬è·¯" class="table-of-contents__link">æŒç»­äº¤ä»˜â€œé«˜é€Ÿå…¬è·¯â€</a></li><li><a href="#éƒ¨ç½²ç¯å¢ƒ" class="table-of-contents__link">éƒ¨ç½²ç¯å¢ƒ</a><ul><li><a href="#jenkins-ç¯å¢ƒ" class="table-of-contents__link">Jenkins ç¯å¢ƒ</a></li><li><a href="#github-ä»“åº“ç¯å¢ƒ" class="table-of-contents__link">GitHub ä»“åº“ç¯å¢ƒ</a></li><li><a href="#kubevela-ç¯å¢ƒ" class="table-of-contents__link">KubeVela ç¯å¢ƒ</a></li></ul></li><li><a href="#ç¼–å†™åº”ç”¨" class="table-of-contents__link">ç¼–å†™åº”ç”¨</a></li><li><a href="#é…ç½®-ci-æµæ°´çº¿" class="table-of-contents__link">é…ç½® CI æµæ°´çº¿</a><ul><li><a href="#æµ‹è¯•æµæ°´çº¿" class="table-of-contents__link">æµ‹è¯•æµæ°´çº¿</a></li><li><a href="#éƒ¨ç½²æµæ°´çº¿" class="table-of-contents__link">éƒ¨ç½²æµæ°´çº¿</a></li></ul></li><li><a href="#å®é™…è¡¨ç°" class="table-of-contents__link">å®é™…è¡¨ç°</a></li><li><a href="#å°ç»“" class="table-of-contents__link">å°ç»“</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">æ–‡æ¡£</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/end-user/quick-start-cli">å¿«é€Ÿå¼€å§‹</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/tutorials/webservice">å®è·µæ•™ç¨‹</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/platform-engineers/oam/oam-model">è‡ªå®šä¹‰æ‰©å±•</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">ç¤¾åŒº</h4><ul class="footer__items"><li class="footer__item"><a href="https://slack.cncf.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CNCF Slack ( #kubevela channel )</a></li><li class="footer__item"><a href="https://gitter.im/oam-dev/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog/2021/09/02/">é’‰é’‰ (23310022)</a></li><li class="footer__item"><div class="wechat"> <a class="wechat-label">Wechat Group(Scan code to request joining)</a> <a class="wechat-img" rel="noreferrer noopener" aria-label="Wechat Group"><img src="https://static.kubevela.net/images/barnett-wechat.jpg" alt="Broker wechat to add you into the user group."></a></div></li></ul></div><div class="col footer__col"><h4 class="footer__title">æ›´å¤š</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/oam-dev/kubevela" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog">åšå®¢</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Â© KubeVela Authors 2021 | Documentation Distributed under <a herf="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a> </strong> <strong>| Powered by <a href="https://www.netlify.com">Netlify</a></strong>
        <br>
      </div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.312f92b6.js"></script>
<script src="/zh/assets/js/main.aa5d7873.js"></script>
</body>
</html>